# Wellbee プロダクト概要

## 1. プロジェクト概要

**Wellbee** は、ウェルネス・フィットネス管理プラットフォームです。ユーザーがヨガ、ピラティス、フィットネスなどの各種コースに参加し、健康管理とウェルビーイングの向上を図るためのシステムです。

### 主要機能

- **メンバーシップ管理**: ユーザーが複数のコースに対してメンバーシップを購入・管理
- **予約システム**: クラススロットの予約・キャンセル機能
- **チェックイン管理**: スタッフによるQRコードを使用した出席管理
- **健康調査**: 身体測定（身長・体重・BMI）とメンタルヘルスアンケート
- **ポイントシステム**: 参加や健康調査に対するポイント報酬
- **スタッフ管理機能**: コース・スロット管理、メンバーシップ承認、ダイレクトメッセージング

---

## 2. 技術スタック

### バックエンド
- **フレームワーク**: Django 4.2.14
- **API**: Django REST Framework 3.15.2
- **データベース**: MySQL 8.0
- **認証**: JWT (djangorestframework-simplejwt)
- **環境管理**: Docker + Docker Compose
- **Webサーバー**: Nginx + Gunicorn

### フロントエンド
- **フレームワーク**: Flutter 3.0.0+1
- **状態管理**: Riverpod 2.6.1
- **HTTP通信**: http 1.2.1
- **UI/UX機能**:
  - カレンダー予約（booking_calendar, table_calendar）
  - QRコード生成・スキャン（qr_flutter, mobile_scanner）
  - アンケート機能（survey_kit）
  - グラフ表示（fl_chart）

### インフラ
- **コンテナ化**: Docker
- **クラウド**: AWS（将来的な利用を想定）

---

## 3. ユーザーロール

### 一般ユーザー
- 電話番号ベースでアカウント登録
- 参加者プロフィール作成
- メンバーシップ購入
- クラス予約・キャンセル
- 健康調査回答
- ポイント獲得・確認

### スタッフユーザー
- スタッフ専用ログイン
- コース管理（作成・編集）
- スロット（クラス枠）管理
- メンバーシップ承認
- QRコードスキャンによるチェックイン
- ユーザー健康データ確認
- ダイレクトメッセージング

---

## 4. 主要ビジネスフロー

### 4.1 ユーザー登録からクラス参加まで

```
1. ユーザー登録（電話番号 + パスワード）
   ↓
2. JWT トークン取得
   ↓
3. 参加者プロフィール作成（Attendee）
   ↓
4. コース選択
   ↓
5. メンバーシップ購入
   - 期間選択（1/2/3/6/12ヶ月）
   - 週あたり参加回数選択
   - 割引・オファー適用
   - 料金自動計算
   ↓
6. スタッフがスロット（クラス枠）を作成
   ↓
7. ユーザーが予約（Reservation）
   ↓
8. クラス当日、スタッフがQRコードスキャン
   ↓
9. チェックイン完了
   - ポイント +1
   - 参加回数カウント増加
```

### 4.2 健康管理フロー

```
1. 健康体測定
   - 身長・体重入力
   - BMI自動計算
   - ポイント +1
   ↓
2. メンタルヘルスアンケート（20問）
   - 4カテゴリー評価
   - スコア自動計算
   ↓
3. グラフ表示（Flutter）
   - BMI推移
   - スコア推移
```

---

## 5. ポイント報酬システム

ユーザーは以下のアクションでポイントを獲得できます：

| アクション | ポイント |
|----------|---------|
| メンバーシップ登録 | +1 |
| チェックイン完了 | +1 |
| 健康体測定完了 | +1 |

---

## 6. 提供コース

- Yoga（ヨガ）
- Pilates（ピラティス）
- Fitness（フィットネス）
- Music（ミュージック）
- Dance（ダンス）
- Karate（空手）
- その他カスタムコース

各コースには：
- プライベート/グループの設定
- 開講/休講状態管理
- アセット画像パス管理

---

## 7. メンバーシップ料金システム

### 料金計算式

```
割引後合計金額 = (基本料金 - (割引額 + オファー額)) × 割引率
```

### 最大参加回数計算

- **グループコース**: `週あたり回数 × 期間（月数）× 4`
- **プライベートコース**: `週あたり回数`

### 有効期限計算

```
有効期限 = 開始日 + 期間（月数）
```

---

## 8. 予約システム

### スロット管理
- 日付・開始時刻・終了時刻
- 最大定員設定（デフォルト25名）
- 予約人数の自動更新
- 満席フラグ管理
- キャンセル状態管理

### 予約制限
- メンバーシップの最大参加回数内
- スロット定員以内
- 有効期限内のメンバーシップ

---

## 9. セキュリティ

### 認証機構
- JWT トークンベース認証
- アクセストークン有効期限: 約3年（開発環境）
- クエリパラメータ + Authorization ヘッダー両方で検証

### 権限管理
- アクションベースの詳細な権限設定
- スタッフ専用エンドポイント
- ユーザー個人データのアクセス制限

### データ保護
- パスワード暗号化（Django標準）
- CORS設定

---

## 10. モバイル対応

### プラットフォーム
- iOS
- Android
- Web
- Linux
- macOS

### 主要UI機能
- レスポンシブデザイン（flutter_screenutil）
- カレンダービュー（週・月表示）
- QRコードスキャン・生成
- グラフ・チャート表示
- カメラアクセス（プロフィール画像等）

---

## 11. 現在の開発状況

### 開発ブランチ
`feature/course_add_by_staff`

### 直近のコミット
1. `296707c` - fetch image from DB
2. `85c8a50` - before course add by staff
3. `9c252dc` - before the course edit 2

### 開発中の機能
スタッフによるコース追加機能の実装

---

## 12. 今後の拡張性

### 推奨される改善項目
- 非同期処理導入（Celery + Redis）
- キャッシング機構
- クエリ最適化（N+1問題対策）
- AWS Secrets Managerによる秘密情報管理
- 多言語対応
- プッシュ通知機能
- ソーシャルログイン統合

---

## 13. ビジネス価値

### ユーザーにとって
- 簡単なコース予約・管理
- 健康状態の可視化
- ポイント報酬によるモチベーション向上
- モバイルアプリによるいつでもどこでもアクセス

### スタッフにとって
- 効率的な出席管理（QRコード）
- メンバーシップ・予約の一元管理
- ユーザー健康データの追跡
- ダイレクトコミュニケーション機能

### ビジネスにとって
- 自動化された料金計算
- データ駆動の意思決定
- スケーラブルなインフラ
- マルチプラットフォーム展開

---

## 14. サポート・お問い合わせ

プロジェクトに関する詳細は、システムアーキテクチャドキュメントをご参照ください。
